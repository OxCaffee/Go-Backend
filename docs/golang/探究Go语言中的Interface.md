# 探究Go语言中的interface

## 前言

Go语言并没有设计诸如虚函数，纯虚函数，继承，多重继承等概念，但是它通过接口非常优雅地实现了支持面向对象地特性。多态是一种**运行期**的行为，有下面几个特点：

* 一种类型具有多种类型的能力
* 允许不同的对象对同一个消息做出灵活的反应
* 以一种通用的方式对待使用的对象
* 非动态语言必须通过继承和接口的方式来实现

Golang通过接口`interfacc`的方式实现了面向对象的特性，即**鸭子类型** ：

```markdown
如果一个动物长得像鸭子，行为像鸭子，那么它有极大的可能就是鸭子
```

鸭子类型是一种动态语言的风格，在这种风格下，一个对象的有效的语义，不是由继承自特定的类或者特定的接口，例如Java中的：

```java
public class Duck implements AnimalIface {...}
```

而是由**它当前的方法或者属性的集合**决定。Go作为一种现代静态语言，通过接口实现了鸭子类型，实际上是Go的编译器在其中做了隐匿转换。

## 探究的目标

- 函数和方法在运行时如何被调用。
- interface 如何构建，其内容如何组成。
- 动态分发是如何实现的，什么时候进行，并且有什么样的调用成本。
- 空接口和其它特殊情况有什么异同。
- 怎么组合 interface 完成工作。
- 如何进行断言，断言的成本有多高。

## Go语言方法的调用

Go语言支持四种不同类型的函数：

* **顶级方法**
* **值receiver的方法**
* **指针receiver的方法**
* **方法字面量(需要对函数闭包非常熟悉，本文不会展开)**

同时支持五种不同类型的方法调用：

* **直接调用顶级函数** 

```GO
func TopLevel(x int) {}
```

* **直接调用值receiver的方法**

```go
func (Value) M(int) {}
```

* **直接调用指针receiver的方法**

```go
func (*Pointer) M(int) {}
```

* **间接调用接口的方法**

```go
type iface interface {
    M(int)
}
```

* **间接调用函数值**

```go
var val = func(x int) {}
```

### 顶级方法调用

下面是一段顶级代码的执行过程：

```go
func Add(a, b int) int {
	return a + b
}

func main() {
	Add(10, 20)
}
```

执行`go tool compile -S main.go`查看汇编代码：

<div align=center><img src="/assets/if1.png"/></div>

函数调用会被直接翻译成跳转指令，目标是`.TEXT`段的全局函数符号，**参数和返回值会被存储在发起调用者的栈帧上** 。

## 直接调用指针receiver的方法

